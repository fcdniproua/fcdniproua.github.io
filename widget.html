<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlaBlaCar Widget</title>

<!-- Content Security Policy –¥–ª—è –¥–æ–∑–≤–æ–ª—É HTTPS –∫–æ–Ω—Ç–µ–Ω—Ç—É -->
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

<!-- –°—Ç–∏–ª—ñ –≤—ñ–¥–∂–µ—Ç–∞ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://ims.blablacar.pro/white-label/widget/assets/css/app.css" media="all">
<link rel="stylesheet" href="https://ims.blablacar.pro/white-label/widget/assets/print.css" media="print">

<style>
html, body {
    margin: 0;
    padding: 0;
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
    box-sizing: border-box;
}

#app {
    min-height: 800px;
    height: auto;
    width: 100%;
    overflow: visible;
    box-sizing: border-box;
}

.container, .container-fluid {
    height: auto !important;
    min-height: auto !important;
}

/* –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω —Ç–∞ LiqPay */
.modal, .popup, .overlay, iframe[src*="liqpay"] {
    position: fixed !important;
    z-index: 9999 !important;
}

/* –°—Ç–∏–ª—ñ –¥–ª—è LiqPay iframe */
iframe[src*="liqpay"] {
    border: none !important;
    width: 100% !important;
    max-width: 600px !important;
    height: 600px !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
}

/* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–æ–±–∫–∏ –ø–ª–∞—Ç–µ–∂—É */
.payment-processing {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #007bff;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 14px;
    z-index: 10000;
    display: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.payment-success {
    background: #28a745 !important;
}

.payment-error {
    background: #dc3545 !important;
}

.payment-warning {
    background: #ffc107 !important;
    color: #000 !important;
}

/* Overlay –¥–ª—è 3DS - –í–ò–ú–ö–ù–ï–ù–û */
.payment-overlay {
    display: none !important;
    pointer-events: none !important;
}
</style>
</head>
<body>

<!-- Overlay –¥–ª—è 3DS -->
<div id="payment-overlay" class="payment-overlay"></div>

<!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É –ø–ª–∞—Ç–µ–∂—É -->
<div id="payment-status" class="payment-processing">
    <span id="payment-message">–û–±—Ä–æ–±–∫–∞ –ø–ª–∞—Ç–µ–∂—É...</span>
</div>

<!-- –í—ñ–¥–∂–µ—Ç -->
<div id="app" 
     data-spa="1" 
     data-ptoken="f5059429-7229-40e7-a2c4-feb24471e21d" 
     data-lang="uk" 
     data-env="prod"></div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
let lastHeight = 0;
let heightCheckInterval;
let isWidgetLoaded = false;
let paymentInProgress = false;
let paymentStatusChecker = null;
let lastPaymentTimestamp = 0;
let liqpayWindow = null;

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä–æ—É—Ç—É –≤—ñ–¥–∂–µ—Ç–∞
function getCurrentRoute() {
    const url = window.location.href;
    const path = window.location.pathname;
    const hash = window.location.hash;
    
    if (url.includes('/search') || path.includes('/search') || hash.includes('search')) {
        return 'search';
    }
    if (url.includes('/checkout') || path.includes('/checkout') || hash.includes('checkout')) {
        return 'checkout';
    }
    if (url.includes('/buy/success') || path.includes('/buy/success') || hash.includes('success')) {
        return 'success';
    }
    if (url.includes('/buy/error') || path.includes('/buy/error') || hash.includes('error')) {
        return 'error';
    }
    
    return 'home';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —Å—Ç–∞—Ç—É—Å—É –ø–ª–∞—Ç–µ–∂—É
function showPaymentStatus(message, type = 'processing') {
    const statusEl = document.getElementById('payment-status');
    const messageEl = document.getElementById('payment-message');
    
    if (statusEl && messageEl) {
        messageEl.textContent = message;
        statusEl.className = 'payment-processing';
        
        if (type === 'success') {
            statusEl.classList.add('payment-success');
        } else if (type === 'error') {
            statusEl.classList.add('payment-error');
        } else if (type === 'warning') {
            statusEl.classList.add('payment-warning');
        }
        
        statusEl.style.display = 'block';
        
        if (type !== 'processing') {
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 10000);
        }
    }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É
function hidePaymentStatus() {
    const statusEl = document.getElementById('payment-status');
    if (statusEl) {
        statusEl.style.display = 'none';
    }
}

// –ü–æ–∫–∞–∑—É—î–º–æ overlay - –í–ò–ú–ö–ù–ï–ù–û
function showPaymentOverlay() {
    // Overlay –≤–∏–º–∫–Ω–µ–Ω–æ, —â–æ–± –Ω–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ –≤—ñ–¥–∂–µ—Ç
    return;
}

// –ü—Ä–∏—Ö–æ–≤—É—î–º–æ overlay - –í–ò–ú–ö–ù–ï–ù–û
function hidePaymentOverlay() {
    // Overlay –≤–∏–º–∫–Ω–µ–Ω–æ
    return;
}

// –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è HTTP –Ω–∞ HTTPS –¥–ª—è LiqPay
function fixLiqPayUrls() {
    // –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ LiqPay —ñ –∑–º—ñ–Ω—é—î–º–æ HTTP –Ω–∞ HTTPS
    const originalFetch = window.fetch;
    window.fetch = function(url, options) {
        if (typeof url === 'string' && url.includes('liqpay.ua')) {
            url = url.replace('http://', 'https://');
            console.log('üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ URL LiqPay –Ω–∞ HTTPS:', url);
        }
        return originalFetch(url, options);
    };
    
    // –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è iframe
    const originalCreateElement = document.createElement;
    document.createElement = function(tagName) {
        const element = originalCreateElement.call(document, tagName);
        
        if (tagName.toLowerCase() === 'iframe') {
            const originalSetAttribute = element.setAttribute;
            element.setAttribute = function(name, value) {
                if (name === 'src' && typeof value === 'string' && value.includes('liqpay.ua')) {
                    value = value.replace('http://', 'https://');
                    console.log('üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ src iframe LiqPay –Ω–∞ HTTPS:', value);
                }
                return originalSetAttribute.call(this, name, value);
            };
        }
        
        return element;
    };
}

// –î–µ—Ç–µ–∫—Ü—ñ—è –ø–æ—á–∞—Ç–∫—É –ø—Ä–æ—Ü–µ—Å—É –æ–ø–ª–∞—Ç–∏
function detectPaymentStart() {
    document.addEventListener('click', function(event) {
        const target = event.target;
        const isPaymentButton = target && (
            (target.textContent && (
                target.textContent.includes('–û–ø–ª–∞—Ç–∏—Ç–∏') ||
                target.textContent.includes('–ö—É–ø–∏—Ç–∏') ||
                target.textContent.includes('–ó–∞–º–æ–≤–∏—Ç–∏') ||
                target.textContent.includes('Pay') ||
                target.textContent.includes('Buy')
            )) ||
            (target.className && (
                target.className.includes('pay') ||
                target.className.includes('buy') ||
                target.className.includes('checkout')
            )) ||
            target.closest('[class*="pay"]') ||
            target.closest('[class*="buy"]') ||
            target.closest('[class*="checkout"]')
        );
        
        if (isPaymentButton) {
            console.log('üîÑ –í–∏—è–≤–ª–µ–Ω–æ –ø–æ—á–∞—Ç–æ–∫ –ø—Ä–æ—Ü–µ—Å—É –æ–ø–ª–∞—Ç–∏');
            paymentInProgress = true;
            lastPaymentTimestamp = Date.now();
            showPaymentStatus('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–ª–∞—Ç–µ–∂—É...', 'processing');
            // showPaymentOverlay(); - –í–ò–ú–ö–ù–ï–ù–û, —â–æ–± –Ω–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ –≤—ñ–¥–∂–µ—Ç
            
            // –ó–∞–ø—É—Å–∫–∞—î–º–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
            setTimeout(() => {
                startPaymentStatusMonitoring();
            }, 2000);
        }
    }, true);
}

// –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å—É –ø–ª–∞—Ç–µ–∂—É
function startPaymentStatusMonitoring() {
    if (paymentStatusChecker) {
        clearInterval(paymentStatusChecker);
    }
    
    let checkCount = 0;
    const maxChecks = 240; // 20 —Ö–≤–∏–ª–∏–Ω –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
    
    showPaymentStatus('–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–ª–∞—Ç—ñ–∂–Ω–æ—ó —Ñ–æ—Ä–º–∏...', 'processing');
    
    paymentStatusChecker = setInterval(() => {
        checkCount++;
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ URL
        const currentRoute = getCurrentRoute();
        
        if (currentRoute === 'success') {
            console.log('‚úÖ –ü–ª–∞—Ç—ñ–∂ —É—Å–ø—ñ—à–Ω–∏–π (URL)');
            handlePaymentSuccess({ source: 'url_detection', route: currentRoute });
            clearInterval(paymentStatusChecker);
            return;
        }
        
        if (currentRoute === 'error') {
            console.log('‚ùå –ü–ª–∞—Ç—ñ–∂ –Ω–µ—É—Å–ø—ñ—à–Ω–∏–π (URL)');
            handlePaymentError({ source: 'url_detection', route: currentRoute });
            clearInterval(paymentStatusChecker);
            return;
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å LiqPay iframe
        const liqpayIframes = document.querySelectorAll('iframe[src*="liqpay"]');
        if (liqpayIframes.length > 0) {
            console.log('üí≥ –ó–Ω–∞–π–¥–µ–Ω–æ LiqPay iframe');
            showPaymentStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–ª–∞—Ç—ñ–∂–Ω–æ—ó —Ñ–æ—Ä–º–∏ LiqPay...', 'processing');
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ —É—Å–ø—ñ—Ö—É/–ø–æ–º–∏–ª–∫–∏
        const successElements = document.querySelectorAll('[class*="success"], [class*="complete"], [class*="paid"]');
        const errorElements = document.querySelectorAll('[class*="error"], [class*="fail"], [class*="declined"]');
        
        if (successElements.length > 0) {
            const successText = Array.from(successElements).map(el => el.textContent).join(' ');
            if (successText.includes('—É—Å–ø—ñ—à–Ω–æ') || successText.includes('success') || successText.includes('complete')) {
                console.log('‚úÖ –ü–ª–∞—Ç—ñ–∂ —É—Å–ø—ñ—à–Ω–∏–π (DOM)');
                handlePaymentSuccess({ source: 'dom_detection' });
                clearInterval(paymentStatusChecker);
                return;
            }
        }
        
        if (errorElements.length > 0) {
            const errorText = Array.from(errorElements).map(el => el.textContent).join(' ');
            if (errorText.includes('–ø–æ–º–∏–ª–∫–∞') || errorText.includes('error') || errorText.includes('fail')) {
                console.log('‚ùå –ü–ª–∞—Ç—ñ–∂ –Ω–µ—É—Å–ø—ñ—à–Ω–∏–π (DOM)');
                handlePaymentError({ source: 'dom_detection' });
                clearInterval(paymentStatusChecker);
                return;
            }
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        if (checkCount % 30 === 0) {
            const minutes = Math.floor(checkCount / 12);
            showPaymentStatus(`–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É... (${minutes} —Ö–≤)`, 'processing');
        }
        
        // –¢–∞–π–º-–∞—É—Ç
        if (checkCount >= maxChecks) {
            console.log('‚è∞ –¢–∞–π–º-–∞—É—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–ª–∞—Ç–µ–∂—É');
            showPaymentStatus('–ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –æ—Å–æ–±–∏—Å—Ç–æ–º—É –∫–∞–±—ñ–Ω–µ—Ç—ñ.', 'warning');
            paymentInProgress = false;
            hidePaymentOverlay();
            clearInterval(paymentStatusChecker);
        }
    }, 5000);
}

// –û–±—Ä–æ–±–∫–∞ —É—Å–ø—ñ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂—É
function handlePaymentSuccess(data = {}) {
    console.log('‚úÖ –£—Å–ø—ñ—à–Ω–∏–π –ø–ª–∞—Ç—ñ–∂:', data);
    
    paymentInProgress = false;
    hidePaymentOverlay();
    showPaymentStatus('‚úÖ –ü–ª–∞—Ç—ñ–∂ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'success');
    
    if (window.parent && window.parent !== window) {
        window.parent.postMessage({
            type: 'payment_success',
            data: { ...data, timestamp: Date.now() },
            source: 'blablacar-widget'
        }, '*');
    }
    
    if (paymentStatusChecker) {
        clearInterval(paymentStatusChecker);
    }
}

// –û–±—Ä–æ–±–∫–∞ –Ω–µ—É—Å–ø—ñ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂—É
function handlePaymentError(data = {}) {
    console.log('‚ùå –ù–µ—É—Å–ø—ñ—à–Ω–∏–π –ø–ª–∞—Ç—ñ–∂:', data);
    
    paymentInProgress = false;
    hidePaymentOverlay();
    showPaymentStatus('‚ùå –ü–ª–∞—Ç—ñ–∂ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.', 'error');
    
    if (window.parent && window.parent !== window) {
        window.parent.postMessage({
            type: 'payment_error',
            data: { ...data, timestamp: Date.now() },
            source: 'blablacar-widget'
        }, '*');
    }
    
    if (paymentStatusChecker) {
        clearInterval(paymentStatusChecker);
    }
}

// –û–±—Ä–æ–±–∫–∞ —Ñ–æ–∫—É—Å—É –≤—ñ–∫–Ω–∞
function handleWindowFocus() {
    window.addEventListener('focus', function() {
        if (paymentInProgress) {
            console.log('üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø—ñ—Å–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ñ–æ–∫—É—Å—É');
            
            setTimeout(() => {
                const currentRoute = getCurrentRoute();
                
                if (currentRoute === 'success') {
                    handlePaymentSuccess({ source: 'window_focus' });
                } else if (currentRoute === 'error') {
                    handlePaymentError({ source: 'window_focus' });
                }
            }, 2000);
        }
    });
}

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤–∏—Å–æ—Ç–∏ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–º—É –≤—ñ–∫–Ω—É
function sendHeightToParent() {
    try {
        const heights = [
            document.body.scrollHeight,
            document.body.offsetHeight,
            document.documentElement.scrollHeight,
            document.documentElement.offsetHeight,
            window.innerHeight
        ];
        
        const appElement = document.getElementById('app');
        if (appElement) {
            heights.push(appElement.scrollHeight, appElement.offsetHeight);
        }
        
        const currentRoute = getCurrentRoute();
        const minHeights = {
            'search': 500,
            'checkout': 600,
            'success': 350,
            'error': 350,
            'home': 400
        };
        
        const calculatedHeight = Math.max(...heights, minHeights[currentRoute] || 400);
        
        if (Math.abs(calculatedHeight - lastHeight) > 10 || !isWidgetLoaded) {
            lastHeight = calculatedHeight;
            isWidgetLoaded = true;
            
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'iframeResize',
                    iframeHeight: calculatedHeight,
                    route: currentRoute,
                    source: 'blablacar-widget'
                }, '*');
            }
        }
    } catch (error) {
        console.warn('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤–∏—Å–æ—Ç–∏:', error);
    }
}

// –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —Ä–æ—É—Ç—É
function trackRouteChanges() {
    let currentRoute = getCurrentRoute();
    
    const checkRoute = () => {
        const newRoute = getCurrentRoute();
        if (newRoute !== currentRoute) {
            currentRoute = newRoute;
            handleRouteChange(newRoute);
        }
    };
    
    window.addEventListener('popstate', () => setTimeout(checkRoute, 100));
    window.addEventListener('hashchange', () => setTimeout(checkRoute, 100));
    setInterval(checkRoute, 1000);
}

// –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ —Ä–æ—É—Ç—É
function handleRouteChange(route) {
    console.log('–ó–º—ñ–Ω–∞ —Ä–æ—É—Ç—É –Ω–∞:', route);
    
    if (window.parent && window.parent !== window) {
        window.parent.postMessage({
            type: 'routeChange',
            route: route,
            url: window.location.href,
            source: 'blablacar-widget'
        }, '*');
    }
    
    setTimeout(sendHeightToParent, 200);
    setTimeout(sendHeightToParent, 1000);
    
    if (route === 'success') {
        handlePaymentSuccess({ route: 'success', source: 'route_change' });
    }
    
    if (route === 'error') {
        handlePaymentError({ route: 'error', source: 'route_change' });
    }
}

// –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á –∑–∞ –∑–º—ñ–Ω–∞–º–∏ DOM
const observer = new MutationObserver((mutations) => {
    let shouldUpdate = false;
    
    mutations.forEach((mutation) => {
        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
            shouldUpdate = true;
            
            mutation.addedNodes.forEach(node => {
                if (node.nodeType === 1) {
                    const text = node.textContent || '';
                    const className = node.className || '';
                    
                    if (paymentInProgress) {
                        if (text.includes('—É—Å–ø—ñ—à–Ω–æ') || text.includes('success') ||
                            className.includes('success')) {
                            handlePaymentSuccess({ source: 'dom_mutation' });
                        }
                        
                        if (text.includes('–ø–æ–º–∏–ª–∫–∞') || text.includes('error') ||
                            className.includes('error')) {
                            handlePaymentError({ source: 'dom_mutation' });
                        }
                    }
                }
            });
        } else if (mutation.type === 'attributes') {
            shouldUpdate = true;
        }
    });
    
    if (shouldUpdate) {
        setTimeout(sendHeightToParent, 100);
    }
});

// –û–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
window.addEventListener('message', function(event) {
    try {
        const data = event.data;
        
        if (data && typeof data === 'object') {
            // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ LiqPay
            if (data.liqpay || event.origin.includes('liqpay')) {
                console.log('üí≥ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ LiqPay:', data);
                
                if (data.status === 'success' || data.action === 'success') {
                    handlePaymentSuccess({ source: 'liqpay', data });
                } else if (data.status === 'error' || data.action === 'error') {
                    handlePaymentError({ source: 'liqpay', data });
                } else if (data.action === '3ds_verify') {
                    showPaymentStatus('–ü—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è 3DS –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏...', 'processing');
                }
            }
            
            // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
            if (data.type === 'payment_complete' || data.status === 'success') {
                handlePaymentSuccess({ source: 'postmessage', data });
            }
            
            // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
            if (data.type === 'payment_error' || data.status === 'error') {
                handlePaymentError({ source: 'postmessage', data });
            }
        }
    } catch (error) {
        console.warn('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);
    }
});

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
function initializeWidget() {
    console.log('üöÄ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—ñ–¥–∂–µ—Ç–∞ BlaBlaCar');
    console.log('üìç URL:', window.location.href);
    
    // –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ URLs –¥–ª—è LiqPay
    fixLiqPayUrls();
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—Å—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏
    trackRouteChanges();
    detectPaymentStart();
    handleWindowFocus();
    
    // –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á DOM
    observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['style', 'class', 'height']
    });
    
    // –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Å–æ—Ç–∏
    let checkCount = 0;
    heightCheckInterval = setInterval(() => {
        sendHeightToParent();
        checkCount++;
        
        if (checkCount >= 40) {
            clearInterval(heightCheckInterval);
            setInterval(sendHeightToParent, 3000);
        }
    }, 500);
    
    setTimeout(() => handleRouteChange(getCurrentRoute()), 1000);
}

// –ó–∞–ø—É—Å–∫
window.addEventListener('load', () => setTimeout(initializeWidget, 500));
window.addEventListener('resize', () => setTimeout(sendHeightToParent, 100));

if (document.readyState !== 'loading') {
    setTimeout(initializeWidget, 200);
} else {
    document.addEventListener('DOMContentLoaded', () => setTimeout(initializeWidget, 200));
}

setTimeout(sendHeightToParent, 1000);
</script>

<!-- –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –≤—ñ–¥–∂–µ—Ç–∞ -->
<script src="https://ims.blablacar.pro/white-label/widget/assets/js/manifest.js"></script>
<script src="https://ims.blablacar.pro/white-label/widget/assets/js/vendor.js"></script>
<script src="https://ims.blablacar.pro/white-label/widget/assets/js/app.js"></script>

</body>
</html>
